(this.webpackJsonpleaderboard=this.webpackJsonpleaderboard||[]).push([[0],{21:function(e,t,n){},35:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),c=n(15),s=n.n(c),o=(n(20),n(21),n(2)),i=n(4),u=n.n(i),l=n(11),d=n(8),b=n.n(d);function f(e,t){var n=Object(a.useRef)(e),r=Object(a.useState)(!1),c=Object(o.a)(r,2),s=c[0],i=c[1];return Object(a.useEffect)((function(){n.current=e}),[e]),Object(a.useEffect)((function(){var e=setInterval((function(){n.current()}),t);return function(){return clearTimeout(e)}}),[n,t,s]),Object(a.useCallback)((function(){return i(!s)}),[s,i])}function j(){var e="object"===typeof window;return{width:e?window.innerWidth:void 0,height:e?window.innerHeight:void 0}}function m(){var e=Object(a.useState)(j),t=Object(o.a)(e,2),n=t[0],r=t[1];return Object(a.useEffect)((function(){if("object"===typeof window)return window.addEventListener("resize",e),function(){window.removeEventListener("resize",e)};function e(){r(j())}}),[]),n}function h(e){return(e.width||0)<=1e3}function p(e){if(!(window.matchMedia&&(window.matchMedia("only screen and (min-resolution: 124dpi), only screen and (min-resolution: 1.3dppx), only screen and (min-resolution: 48.8dpcm)").matches||window.matchMedia("only screen and (-webkit-min-device-pixel-ratio: 1.3), only screen and (-o-min-device-pixel-ratio: 2.6/2), only screen and (min--moz-device-pixel-ratio: 1.3), only screen and (min-device-pixel-ratio: 1.3)").matches)||window.devicePixelRatio&&window.devicePixelRatio>1.3))return e;var t=e.split("."),n=t.pop(),a=t.join(".");return n?"".concat(a,"@2x.").concat(n):e}function O(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:9e3,r=Object(a.useCallback)((function(){t||e()}),[e,t]),c=f(r,n);Object(a.useEffect)((function(){var t=function(){e(),c()};return u.a.bind("space",t),u.a.bind("enter",t),u.a.bind("right",t),function(){u.a.unbind("space"),u.a.unbind("enter"),u.a.unbind("right")}}),[c,t,e])}var g=n(3),v=n.n(g),w=n(7),x=n(5),y=n(38),k=n(37),S=n(10),N=n.n(S),E=function(){var e=Object(w.a)(v.a.mark((function e(t){var n,a,r;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch("".concat(t,"/api/scores/"));case 3:if(200!==(n=e.sent).status){e.next=15;break}return e.t0=N.a,e.next=8,n.json();case 8:return e.t1=e.sent,e.t2={deep:!0},a=(0,e.t0)(e.t1,e.t2),r=new Date,e.abrupt("return",a.map((function(e){var t=Object(y.a)(e.modified),n=t>Object(y.a)(e.created)&&Object(k.a)(r,t)<2592e3;return Object(x.a)(Object(x.a)({},e),{},{gameBannerThumbnail:p(e.gameBannerThumbnail),newScore:n})})));case 15:return e.next=17,n.text();case 17:throw"Failed to get scores: "+e.sent;case 19:e.next=24;break;case 21:throw e.prev=21,e.t3=e.catch(0),"Failed to get scores: "+e.t3;case 24:case"end":return e.stop()}}),e,null,[[0,21]])})));return function(t){return e.apply(this,arguments)}}(),C=function(){var e=Object(w.a)(v.a.mark((function e(t){var n,a;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch("".concat(t,"/api/images/"));case 3:if(200!==(n=e.sent).status){e.next=14;break}return e.t0=N.a,e.next=8,n.json();case 8:return e.t1=e.sent,e.t2={deep:!0},a=(0,e.t0)(e.t1,e.t2),e.abrupt("return",a);case 14:return e.next=16,n.text();case 16:throw"Failed to get scores: "+e.sent;case 18:e.next=23;break;case 20:throw e.prev=20,e.t3=e.catch(0),"Failed to get scores: "+e.t3;case 23:case"end":return e.stop()}}),e,null,[[0,20]])})));return function(t){return e.apply(this,arguments)}}(),I=n(1),L=r.a.createContext(void 0),R=function(e,t){switch(t.type){case"setImages":return Object(x.a)(Object(x.a)({},e),{},{error:void 0,images:t.payload});case"setScores":return Object(x.a)(Object(x.a)({},e),{},{error:void 0,scores:t.payload});case"setError":return Object(x.a)(Object(x.a)({},e),{},{error:t.payload});default:return e}},F={images:[],scores:[]},P=function(e){var t=function(e,t){var n=Object(a.useState)((function(){try{var n=window.localStorage.getItem(e);return n?JSON.parse(n):t}catch(a){return console.log(a),t}})),r=Object(o.a)(n,2),c=r[0],s=r[1];return[c,function(t){try{s(t),window.localStorage.setItem(e,JSON.stringify(t))}catch(n){console.log(n)}}]}("leaderboardUrl","https://btta-api.elwert.cloud"),n=Object(o.a)(t,2),r=n[0],c=n[1],s=Object(a.useReducer)(R,F),i=Object(o.a)(s,2),u=i[0],l=i[1],d=Object(a.useCallback)(Object(w.a)(v.a.mark((function e(){var t;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,C(r);case 3:t=e.sent,l({type:"setImages",payload:t}),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),l({type:"setError",payload:e.t0.toString()});case 10:case"end":return e.stop()}}),e,null,[[0,7]])}))),[l,r]),b=Object(a.useCallback)(Object(w.a)(v.a.mark((function e(){var t;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,E(r);case 3:t=e.sent,l({type:"setScores",payload:t}),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),l({type:"setError",payload:e.t0.toString()});case 10:case"end":return e.stop()}}),e,null,[[0,7]])}))),[l,r]);return Object(a.useEffect)((function(){d(),b()}),[d,b]),Object(I.jsx)(L.Provider,{value:{state:u,baseURL:r,refreshImages:d,refreshScores:b,setBaseURL:c},children:e.children})},B=function(){var e=r.a.useContext(L);if(void 0===e)throw new Error("useCountState must be used within a CountProvider");return e},U=function(e){var t=e.onFinished,n=e.onNextPage,c=e.paused,s=Object(a.useState)(0),i=Object(o.a)(s,2),u=i[0],l=i[1],d=Object(a.useState)(1),f=Object(o.a)(d,2),j=f[0],p=f[1],g=B().state.scores;Object(a.useEffect)((function(){0===g.length&&t(),g.map((function(e){var t=e.gameBannerThumbnail,n=new Image;return n.src=t,n}))}),[g,t]);var v=Object(a.useRef)(null);O(Object(a.useCallback)((function(){var e=u+j,a=e>=g.length?0:e;a!==u&&l(a),0===a?t():n()}),[u,j,g.length,l,t,n]),c);var w=m();return Object(a.useLayoutEffect)((function(){h(w)||p(1)}),[w,p]),Object(a.useLayoutEffect)((function(){var e;if(v.current)if((w.width||0)<1e3)p(g.length);else{var t=v.current.clientHeight,n=null===(e=v.current.firstChild)||void 0===e?void 0:e.firstChild;if(n){var a=Math.floor(t/(n.clientHeight+1));j!==a&&p(a)}}}),[j,p,v,g.length,w]),Object(I.jsx)("div",{className:"scoresContainer",ref:v,children:Object(I.jsx)("div",{className:"scores",children:g.slice(u,u+j).map((function(e,t){return Object(I.jsxs)(r.a.Fragment,{children:[0!==t&&Object(I.jsx)("span",{className:"line"}),Object(I.jsx)("span",{className:b()("gameName",{newScore:e.newScore}),children:Object(I.jsx)("img",{src:e.gameBannerThumbnail,alt:e.gameName})}),Object(I.jsx)("span",{className:b()("playerName",{newScore:e.newScore}),children:e.playerName}),Object(I.jsx)("span",{className:b()("score",{newScore:e.newScore}),children:Number(e.playerScore).toLocaleString()})]},e.id)}))})})},M=function(e){var t=e.onFinished,n=e.onNextPage,r=e.paused,c=e.page,s=B().state.images,o=h(m());Object(a.useEffect)((function(){o||s.map((function(e){var t=e.image,n=new Image;return n.src=t,n}))}),[s,o]);var i=s.length?c%s.length:0;Object(a.useEffect)((function(){s.length<=i&&t()}),[i,s.length,t]),O(n,r);var u=s[i];return Object(I.jsx)("div",{className:"imageContainer",children:u&&Object(I.jsx)("img",{src:u.image,alt:u.name,className:"fullscreenImage"})})};var T=function(){var e=Object(a.useRef)(null),t=B(),n=t.state,r=t.baseURL,c=t.setBaseURL,s=t.refreshImages,i=t.refreshScores,d=Object(a.useState)(!1),b=Object(o.a)(d,2),f=b[0],j=b[1],p=Object(a.useState)("images"),O=Object(o.a)(p,2),g=O[0],v=O[1],w=Object(a.useState)(0),x=Object(o.a)(w,2),y=x[0],k=x[1],S=h(m()),N=Object(a.useCallback)((function(){j(!f)}),[f,j]);Object(a.useEffect)((function(){if("form"!==g)return u.a.bind("p",N),function(){u.a.unbind("p")}}),[N,g]);var E=Object(a.useCallback)((function(){switch(g){case"images":v("leaderboard"),k(y+1)}}),[v,g,y,k]),C=Object(a.useCallback)((function(){switch(g){case"form":v("leaderboard");break;case"leaderboard":v("images"),S||i();break;case"images":v("leaderboard"),k(0),S||s();break;default:v("leaderboard")}}),[v,g,s,i,k,S]),L=Object(a.useCallback)((function(){e.current&&c(e.current.value),v("leaderboard")}),[v,e,c]),R=Object(a.useCallback)((function(){v("form"),window.requestAnimationFrame((function(){if(!e.current)throw Error("couldn't get input ref");e.current.value=r}))}),[v,e,r]),F="form"===g,P=S?!F:"leaderboard"===g,T=S?!F:"images"===g,J=n.scores.length,z=n.images.length;return Object(a.useEffect)((function(){J!==z&&("leaderboard"!==g||J?"images"!==g||z||v("leaderboard"):v("images"))}),[J,z,v,g]),Object(I.jsxs)("div",{className:"App",children:[Object(I.jsxs)("header",{onClick:R,children:[Object(I.jsx)("img",{className:"logo",src:"logo.png",alt:"Back to the Arcade"}),Object(I.jsx)("img",{className:"leaderboard",src:"leaderboard-text.png",alt:"Leaderboard"})]}),n.error&&Object(I.jsxs)("div",{children:[Object(I.jsx)("h2",{children:"Error:"}),n.error]}),F&&Object(I.jsxs)("form",{onSubmit:L,children:["URL: ",Object(I.jsx)("input",{name:"url",ref:e}),Object(I.jsx)("button",{type:"submit",children:"Connect"})]}),J&&P&&Object(I.jsx)(U,{onFinished:C,onNextPage:E,paused:f}),z&&T&&Object(I.jsx)(M,{onFinished:C,onNextPage:E,paused:f,page:y}),Object(I.jsx)("footer",{children:Object(I.jsx)("img",{src:"pacman-ghosts.jpg",alt:""})}),f?Object(I.jsx)(l.a,{className:"playPause"}):Object(I.jsx)(l.b,{className:"playPause fadeOut"})]})};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));s.a.render(Object(I.jsx)(r.a.StrictMode,{children:Object(I.jsx)(P,{children:Object(I.jsx)(T,{})})}),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[35,1,2]]]);
//# sourceMappingURL=main.4bd5e47e.chunk.js.map