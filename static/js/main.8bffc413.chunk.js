(this.webpackJsonpleaderboard=this.webpackJsonpleaderboard||[]).push([[0],{14:function(e,t,n){e.exports=n(33)},20:function(e,t,n){},33:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),c=n(13),o=n.n(c),s=(n(19),n(20),n(1)),i=n(7),u=n.n(i),l=n(4),d=n.n(l);function m(e,t){var n=Object(a.useRef)(e),r=Object(a.useState)(!1),c=Object(s.a)(r,2),o=c[0],i=c[1];return Object(a.useEffect)((function(){n.current=e}),[e]),Object(a.useEffect)((function(){var e=setInterval((function(){n.current()}),t);return function(){return clearTimeout(e)}}),[n,t,o]),Object(a.useCallback)((function(){return i(!o)}),[o,i])}function f(){var e="object"===typeof window;return{width:e?window.innerWidth:void 0,height:e?window.innerHeight:void 0}}function b(){var e=Object(a.useState)(f),t=Object(s.a)(e,2),n=t[0],r=t[1];return Object(a.useEffect)((function(){if("object"===typeof window)return window.addEventListener("resize",e),function(){window.removeEventListener("resize",e)};function e(){r(f())}}),[]),n}function p(e){return(e.width||0)<=1e3}function g(e){if(!(window.matchMedia&&(window.matchMedia("only screen and (min-resolution: 124dpi), only screen and (min-resolution: 1.3dppx), only screen and (min-resolution: 48.8dpcm)").matches||window.matchMedia("only screen and (-webkit-min-device-pixel-ratio: 1.3), only screen and (-o-min-device-pixel-ratio: 2.6/2), only screen and (min--moz-device-pixel-ratio: 1.3), only screen and (min-device-pixel-ratio: 1.3)").matches)||window.devicePixelRatio&&window.devicePixelRatio>1.3))return e;var t=e.split("."),n=t.pop(),a=t.join(".");return n?"".concat(a,"@2x.").concat(n):e}var h=n(2),v=n.n(h),w=n(5),j=n(6),O=n(36),E=n(35),x=n(8),y=n.n(x),k=function(){var e=Object(w.a)(v.a.mark((function e(t){var n,a,r;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch("".concat(t,"/api/scores/"));case 3:if(200!==(n=e.sent).status){e.next=15;break}return e.t0=y.a,e.next=8,n.json();case 8:return e.t1=e.sent,e.t2={deep:!0},a=(0,e.t0)(e.t1,e.t2),r=new Date,e.abrupt("return",a.map((function(e){var t=Object(O.a)(e.modified),n=t>Object(O.a)(e.created)&&Object(E.a)(r,t)<2592e3;return Object(j.a)({},e,{gameBannerThumbnail:g(e.gameBannerThumbnail),newScore:n})})));case 15:return e.next=17,n.text();case 17:throw"Failed to get scores: "+e.sent;case 19:e.next=24;break;case 21:throw e.prev=21,e.t3=e.catch(0),"Failed to get scores: "+e.t3;case 24:case"end":return e.stop()}}),e,null,[[0,21]])})));return function(t){return e.apply(this,arguments)}}(),S=function(){var e=Object(w.a)(v.a.mark((function e(t){var n,a;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch("".concat(t,"/api/images/"));case 3:if(200!==(n=e.sent).status){e.next=14;break}return e.t0=y.a,e.next=8,n.json();case 8:return e.t1=e.sent,e.t2={deep:!0},a=(0,e.t0)(e.t1,e.t2),e.abrupt("return",a);case 14:return e.next=16,n.text();case 16:throw"Failed to get scores: "+e.sent;case 18:e.next=23;break;case 20:throw e.prev=20,e.t3=e.catch(0),"Failed to get scores: "+e.t3;case 23:case"end":return e.stop()}}),e,null,[[0,20]])})));return function(t){return e.apply(this,arguments)}}(),N=r.a.createContext(void 0),C=function(e,t){switch(t.type){case"setImages":return Object(j.a)({},e,{error:void 0,images:t.payload});case"setScores":return Object(j.a)({},e,{error:void 0,scores:t.payload});case"setError":return Object(j.a)({},e,{error:t.payload});default:return e}},I={images:[],scores:[]},L=function(e){var t=function(e,t){var n=Object(a.useState)((function(){try{var n=window.localStorage.getItem(e);return n?JSON.parse(n):t}catch(a){return console.log(a),t}})),r=Object(s.a)(n,2),c=r[0],o=r[1];return[c,function(t){try{o(t),window.localStorage.setItem(e,JSON.stringify(t))}catch(n){console.log(n)}}]}("leaderboardUrl","https://btta-api.elwert.cloud"),n=Object(s.a)(t,2),c=n[0],o=n[1],i=Object(a.useReducer)(C,I),u=Object(s.a)(i,2),l=u[0],d=u[1],m=Object(a.useCallback)(Object(w.a)(v.a.mark((function e(){var t;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,S(c);case 3:t=e.sent,d({type:"setImages",payload:t}),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),d({type:"setError",payload:e.t0.toString()});case 10:case"end":return e.stop()}}),e,null,[[0,7]])}))),[d,c]),f=Object(a.useCallback)(Object(w.a)(v.a.mark((function e(){var t;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,k(c);case 3:t=e.sent,d({type:"setScores",payload:t}),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),d({type:"setError",payload:e.t0.toString()});case 10:case"end":return e.stop()}}),e,null,[[0,7]])}))),[d,c]);return Object(a.useEffect)((function(){m(),f()}),[m,f]),r.a.createElement(N.Provider,{value:{state:l,baseURL:c,refreshImages:m,refreshScores:f,setBaseURL:o}},e.children)},M=function(){var e=r.a.useContext(N);if(void 0===e)throw new Error("useCountState must be used within a CountProvider");return e},R=function(e){var t=e.onFinished,n=e.onNextPage,c=Object(a.useState)(0),o=Object(s.a)(c,2),i=o[0],l=o[1],f=Object(a.useState)(1),g=Object(s.a)(f,2),h=g[0],v=g[1],w=M().state.scores;Object(a.useEffect)((function(){0===w.length&&t(),w.map((function(e){var t=e.gameBannerThumbnail,n=new Image;return n.src=t,n}))}),[w,t]);var j=Object(a.useRef)(null),O=Object(a.useCallback)((function(){var e=i+h,a=e>=w.length?0:e;a!==i&&l(a),0===a?t():n()}),[i,h,w.length,l,t,n]),E=m(O,9e3);Object(a.useEffect)((function(){var e=function(){O(),E()};return d.a.bind("space",e),d.a.bind("enter",e),d.a.bind("right",e),function(){d.a.unbind("space"),d.a.unbind("enter"),d.a.unbind("right")}}),[O,E]);var x=b();return Object(a.useLayoutEffect)((function(){p(x)||v(1)}),[x,v]),Object(a.useLayoutEffect)((function(){var e;if(j.current)if((x.width||0)<1e3)v(w.length);else{var t=j.current.clientHeight,n=null===(e=j.current.firstChild)||void 0===e?void 0:e.firstChild;if(n){var a=Math.floor(t/(n.clientHeight+1));h!==a&&v(a)}}}),[h,v,j,w.length,x]),r.a.createElement("div",{className:"scoresContainer",ref:j},r.a.createElement("div",{className:"scores"},w.slice(i,i+h).map((function(e,t){return r.a.createElement(r.a.Fragment,{key:e.id},0!==t&&r.a.createElement("span",{className:"line"}),r.a.createElement("span",{className:u()("gameName",{newScore:e.newScore})},r.a.createElement("img",{src:e.gameBannerThumbnail,alt:e.gameName})),r.a.createElement("span",{className:u()("playerName",{newScore:e.newScore})},e.playerName),r.a.createElement("span",{className:u()("score",{newScore:e.newScore})},Number(e.playerScore).toLocaleString()))}))))};var F=function(e){var t=e.onFinished,n=e.onNextPage,c=e.page,o=M().state.images,s=p(b());Object(a.useEffect)((function(){s||o.map((function(e){var t=e.image,n=new Image;return n.src=t,n}))}),[o,s]);var i=o.length?c%o.length:0;Object(a.useEffect)((function(){o.length<=i&&t()}),[i,o.length,t]);var u=m(n,9e3);Object(a.useEffect)((function(){var e=function(){n(),u()};return Mousetrap.bind("space",e),Mousetrap.bind("enter",e),Mousetrap.bind("right",e),function(){Mousetrap.unbind("space"),Mousetrap.unbind("enter"),Mousetrap.unbind("right")}}),[n,u]);var l=o[i];return r.a.createElement("div",{className:"imageContainer"},l&&r.a.createElement("img",{src:l.image,alt:l.name,className:"fullscreenImage"}))};var B=function(){var e=Object(a.useRef)(null),t=M(),n=t.state,c=t.baseURL,o=t.setBaseURL,i=t.refreshImages,u=t.refreshScores,l=Object(a.useState)("images"),d=Object(s.a)(l,2),m=d[0],f=d[1],g=Object(a.useState)(0),h=Object(s.a)(g,2),v=h[0],w=h[1],j=p(b()),O=Object(a.useCallback)((function(){switch(m){case"images":f("leaderboard"),w(v+1)}}),[f,m,v,w]),E=Object(a.useCallback)((function(){switch(m){case"form":f("leaderboard");break;case"leaderboard":f("images"),j||u();break;case"images":f("leaderboard"),w(0),j||i();break;default:f("leaderboard")}}),[f,m,i,u,w,j]),x=Object(a.useCallback)((function(){e.current&&o(e.current.value),f("leaderboard")}),[f,e,o]),y=Object(a.useCallback)((function(){f("form"),window.requestAnimationFrame((function(){if(!e.current)throw Error("couldn't get input ref");e.current.value=c}))}),[f,e,c]),k="form"===m,S=j?!k:"leaderboard"===m,N=j?!k:"images"===m,C=n.scores.length,I=n.images.length;return Object(a.useEffect)((function(){C!==I&&("leaderboard"!==m||C?"images"!==m||I||f("leaderboard"):f("images"))}),[C,I,f,m]),r.a.createElement("div",{className:"App"},r.a.createElement("header",{onClick:y},r.a.createElement("img",{className:"logo",src:"logo.png",alt:"Back to the Arcade"}),r.a.createElement("img",{className:"leaderboard",src:"leaderboard-text.png",alt:"Leaderboard"})),n.error&&r.a.createElement("div",null,r.a.createElement("h2",null,"Error:"),n.error),k&&r.a.createElement("form",{onSubmit:x},"URL: ",r.a.createElement("input",{name:"url",ref:e}),r.a.createElement("button",{type:"submit"},"Connect")),C&&S&&r.a.createElement(R,{onFinished:E,onNextPage:O}),I&&N&&r.a.createElement(F,{onFinished:E,onNextPage:O,page:v}),r.a.createElement("footer",null,r.a.createElement("img",{src:"pacman-ghosts.jpg",alt:""})))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(L,null,r.a.createElement(B,null))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[14,1,2]]]);
//# sourceMappingURL=main.8bffc413.chunk.js.map